# 문제 3

사내에서 쓰이는 BO(Back office) 서비스를 개발하려고 합니다.

1. 로그인방식인 OAuth와 JWT 둘중에 어느것을 사용하여 개발을 하실건가요?
2. 둘중 선택한 이유와 장점에 대해 설명해주세요
3. 구현 방법을 서술해 주세요 (다이어그램등을 활용하셔서 첨부하셔도 좋습니다)

---

✅ 백오피스의 클라이언트는 관리자 또는 내부 운영자가 사용하는 내부 관리 시스템입니다.

따라서 사용자가 사내에서 이미 파악된 상태이므로 별도의 제3자 인증이 필요하지 않으며,
JWT 기반 설계가 더 적절하다고 판단됩니다.

OAuth는 인증 및 인가를 제3자에게 위임하는 방식으로, 주로 사용자 예측이 불가능하거나 광범위한 경우에 적합한 전략으로 판단됩니다.

결론은 백오피스는 특정 조직 내에서만 사용되므로 OAuth 대신 JWT 또는 사내 인증 시스템을 활용하는 것이 더 적절하다고 판단됩니다.

`JWT 기반 로그인 전략`

```
+------------------------+
|  ✅ 클라이언트 요청        |
|  (API 요청)             |
+------------------------+
          |
          v
+---------------------------------+
|  ✅ 미들웨어에서 토큰 검증            |
|  ├── 만료 → 리프레시 토큰 확인        |
|  ├── 리프레시 토큰 유효 → 새 토큰 발급  |
|  ├── 리프레시 토큰 만료 → 에러 처리    |
+---------------------------------+
          | 액세스 토큰 유효
          v
+----------------------------+
|  ✅ Redis에서 userId 조회    |
+----------------------------+
  |         |
  |         v
  |   +-------------------------+
  |   |  ✅ Redis 유저 데이터 없음  |
  |   |  DB에서 userId 조회       |
  |   |  ├── 유저 있음 → 캐싱      |
  |   |  ├── 유저 없음 → 에러      |
  |   +-------------------------+
  |
  v
+------------------------+
|  ✅ 서버 요청 처리        |
+------------------------+

```

---

### 💡 추가질문 - 실제로 구현해본 경험이 있다면, 해당 구현 경험을 서술해주세요

실제로 구현한 방식은 앞서 작성한 JWT 인증 흐름도와 유사하며, 추가적으로 고려해야 할 케이스들을 정리하여 반영했습니다.

> 유저의 회원 탈퇴 혹은 비활성화 처리

1. 회원 탈퇴 요청
2. DB 유저 상태값 변경
3. Redis 캐시 삭제
4. JWT 토큰 삭제

> 토큰 복사 및 탈취와 같은 예외 사항 방지

1. 악의적인 사용자가 탈퇴 전 JWT를 복사하여 보관
2. 복제된 JWT를 사용하여 서버에 요청
3. 서버에서 토큰을 복호화하여 userId 추출
4. Redis에서 userId를 조회 (탈퇴 혹은 비활성화 시, 캐시 삭제됨)
5. Redis에 데이터가 없으므로 DB에서 userId 조회
6. 유저의 상태값이 탈퇴 혹은 비활성화라면 요청 차단
